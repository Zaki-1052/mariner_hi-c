=========================================
Mariner Hi-C Extraction - Test Run
=========================================
Job ID: 43302640
Node: exp-2-54
Start time: Mon Oct 13 16:43:41 PDT 2025
=========================================

Environment check:
/home/zalibhai/.conda/envs/mariner_env/bin/R
R version 4.4.2 (2024-10-31) -- "Pile of Leaves"

Starting extraction script...

=================================
Step 5: Hi-C Contact Extraction
=================================

Warning messages:
1: package ‘matrixStats’ was built under R version 4.4.3 
2: package ‘Matrix’ was built under R version 4.4.3 
3: package ‘S4Arrays’ was built under R version 4.4.3 
4: package ‘abind’ was built under R version 4.4.3 
Loading buffered loops...
  Loaded 150 loops with 5x5 pixel regions

Verifying .hic files...
  ctrl: 6.8 GB - OK
  mut: 6.3 GB - OK

Checking .hic file properties...

ctrl file:
  Resolutions (bp): 2500000, 1e+06, 5e+05, 250000, 1e+05 ...
  Normalizations: NONE, INTER_SCALE, GW_SCALE, VC_SQRT, VC, SCALE 

mut file:
  Resolutions (bp): 2500000, 1e+06, 5e+05, 250000, 1e+05 ...
  Normalizations: NONE, INTER_SCALE, GW_SCALE, VC_SQRT, VC, SCALE 

Using normalization: VC

Validating loop positions...
  Chromosomes in loops: 1
  Example chromosomes: chr8
  Maximum anchor width: 25001 bp
  Minimum required blockSize: 50002 bp

=== Starting extraction ===
Processing 150 loops x 2 files x 25 pixels = 7500 total extractions

Extraction completed in 32.4 seconds

=== Validation of Extracted Data ===
Dimensions: 5 x 5 x 150 x 2
  = 5x5 pixels x 150 loops x 2 files

NA values: 0 (0.00%)

Value distribution (excluding NAs):
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   8.646  15.331  19.139  25.488 175.421 

Sparsity: 0.6% zeros

Per-sample statistics:
  ctrl: median=15.67, mean=19.63, max=170
  mut: median=14.98, mean=18.65, max=175

Sample correlation:
  Correlation (ctrl vs mut): 0.918

=== Example Extracted Matrices ===
Showing first 3 loops for control sample:

Loop 1:
       3.24     3.94     3.73     3.34     0.00 
       4.15     4.86     3.28     6.00     1.70 
       2.37     4.63    10.41     6.52     3.23 
       2.72     1.33     3.58     2.10     3.47 
       2.42     1.57     2.12     4.99     2.47 
  Sum: 88, Max: 10, Non-zero: 24/25

Loop 2:
       7.19     9.55    10.94    15.06    17.18 
       7.43    11.71    16.64    18.83    13.31 
      10.62    18.31    42.08    32.91    25.59 
      14.36    21.63    27.81    31.34    20.76 
      16.99    21.05    14.42    18.39    15.95 
  Sum: 460, Max: 42, Non-zero: 25/25

Loop 3:
      33.05    24.97    15.91    12.11    16.83 
      26.05    27.88    36.89    20.28    26.30 
      34.58    46.23    50.58    32.73    40.84 
      56.55    48.58    36.37    34.46    37.45 
      63.38    51.63    34.30    24.24    29.25 
  Sum: 861, Max: 63, Non-zero: 25/25


=== Saving Extracted Data ===
Saving as HDF5 (required for out-of-memory objects)...
Start writing assay 1/3 to HDF5 file:
  outputs/test/05_extractedassays.h5
/ reading and realizing block 1/1 ... ok
\ Writing it ... OK
Finished writing assay 1/3 to HDF5 file:
  outputs/test/05_extractedassays.h5

Start writing assay 2/3 to HDF5 file:
  outputs/test/05_extractedassays.h5
/ reading and realizing block 1/1 ... ok
\ Writing it ... OK
Finished writing assay 2/3 to HDF5 file:
  outputs/test/05_extractedassays.h5

Start writing assay 3/3 to HDF5 file:
  outputs/test/05_extractedassays.h5
/ reading and realizing block 1/1 ... ok
\ Writing it ... OK
Finished writing assay 3/3 to HDF5 file:
  outputs/test/05_extractedassays.h5

Serialize InteractionArray object to RDS file:
  outputs/test/05_extractedse.rds
  Saved to: outputs/test/05_extracted/
  Metadata saved to: outputs/test/05_metadata.rds

=================================
✅ Step 5: Extraction Complete
=================================
- Processed: 150 loops
- Samples: ctrl, mut
- Sample correlation: 0.918
- Normalization: VC
- Time: 32.4 seconds
- Output: outputs/test/05_extracted/
- Ready for aggregation: 150 matrices

Next: Run aggregation script (06_aggregate.R)

To load in next script:
  pixels <- loadHDF5SummarizedExperiment(dir='outputs/test', prefix='05_extracted')

✅ Extraction completed successfully
End time: Mon Oct 13 16:44:26 PDT 2025
=========================================
